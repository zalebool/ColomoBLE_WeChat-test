/**************************************************************************************************
  Filename:       bsp_ruby_led.c
  Revised:        $Date: 2015/9/10 $
  Revision:       $Revision: 1 $

  Description:    This file contains the interface to the bsp ruby capacity measurement.

  Copyright 2015 - 2016 QijiTek. All rights reserved.
**************************************************************************************************/

/***************************************************************************************************
 *                                             INCLUDES
 ***************************************************************************************************/
#include "hal_mcu.h"
#include "hal_defs.h"
#include "hal_types.h"
#include "hal_drivers.h"
#include "osal.h"
#include "hal_board.h"
#include "bsp_ruby_motor.h"
#include "bsp_smart_cover.h"
#include "stdio.h"
#include "bsp_ruby_timer.h"

#if defined POWER_SAVING
#include "bsp_power.h"
#include "OSAL_PwrMgr.h"
#endif


/***************************************************************************************************
 *                                             CONSTANTS
 ***************************************************************************************************/

/***************************************************************************************************
 *                                              MACROS
 ***************************************************************************************************/

/***************************************************************************************************
 *                                              TYPEDEFS
 ***************************************************************************************************/


/***************************************************************************************************
 *                                           GLOBAL VARIABLES
 ***************************************************************************************************/
uint8 BspTimer4DelegateTaskID = BSP_SC_INT_NO_TASK;
uint16 BspTimer4DelegateEvent = BSP_SC_INT_NO_EVENT;
/***************************************************************************************************
 *                                            LOCAL FUNCTION
 ***************************************************************************************************/

/***************************************************************************************************
 *                                            FUNCTIONS - API
 ***************************************************************************************************/
/***************************************************************************************************
 * @fn      BspRubyTimerInit
 *
 * @brief   
 *
 * @param   None
 *          
 *          
 *                    
 *
 * @return  None
 ***************************************************************************************************/
void BspRubyTimer4Init(void)
{
  T4CTL = 0xee;
  T4CC0 = 0xff;
  T4CCTL0 = 0x44;
  IEN1  |= (1<<4);
  //T4CTL |= (1<<4);
}

/***************************************************************************************************
 * @fn      BspRubyTimer1Start
 *
 * @brief   
 *
 * @param   None
 *          
 *          
 *                    
 *
 * @return  None
 ***************************************************************************************************/
void BspRubyTimer1Start(void)
{
  T1CTL  = 0x0e;     //定时器1设置为128分频，模计数器模式
  T1CC0L = 0x99;     //定时器1通道0捕获/比较值低位
  T1CC0H = 0x62;     //定时器1通道0捕获/比较值高位
  T1CNTL = 0x00;     //定时器1计数器低位
  T1CNTH = 0x00;     //定时器1计数器高位
  T1CCTL0 = 0x44;    //通道0比较功能，并且开通道0中断
  T1STAT = 0X21;     //通道0，中断有效。这一句在裸机程序中可有可无
  TIMIF |= (1<<6);   //定时器1溢出中断使能
  IEN1  |= (1<<1);   //定时器1中断使能
}

/***************************************************************************************************
 * @fn      BspRubyTimer4Start
 *
 * @brief   
 *
 * @param   None
 *          
 *          
 *                    
 *
 * @return  None
 ***************************************************************************************************/
void BspRubyTimer4Start(void)
{
  T4CNT = 0x00;
  T4CTL |= (1<<4);
}

/***************************************************************************************************
 * @fn      BspRubyTimer1Stop
 *
 * @brief   
 *
 * @param   None
 *          
 *          
 *                    
 *
 * @return  None
 ***************************************************************************************************/
void BspRubyTimer1Stop(void)
{
  T1CCTL0 = 0x00;    //通道0比较功能，并且开通道0中断
  T1STAT = 0X00;     //通道0，中断有效。这一句在裸机程序中可有可无
  TIMIF &= ~(1<<6);   //定时器1溢出中断使能
  IEN1  &= ~(1<<1);   //定时器1中断使能
}

/***************************************************************************************************
 * @fn      BspRubyTimer4Stop
 *
 * @brief   
 *
 * @param   None
 *          
 *          
 *                    
 *
 * @return  None
 ***************************************************************************************************/
void BspRubyTimer4Stop(void)
{
  T4CTL &= ~(1<<4);
}

/***************************************************************************************************
***************************************************************************************************/