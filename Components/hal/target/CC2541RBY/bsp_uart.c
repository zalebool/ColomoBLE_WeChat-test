/**************************************************************************************************
  Filename:       bsp_uart.c
  Revised:        $Date: 2015/6/18 $
  Revision:       $Revision: 1 $

  Description:    This file contains the interface to the debug uart Service.


  Copyright 2015 - 2016 QijiTek. All rights reserved.
**************************************************************************************************/

/***************************************************************************************************
 *                                             INCLUDES
 ***************************************************************************************************/
#include "bsp_uart.h"

/***************************************************************************************************
 *                                             CONSTANTS
 ***************************************************************************************************/

/***************************************************************************************************
 *                                              MACROS
 ***************************************************************************************************/

/***************************************************************************************************
 *                                              TYPEDEFS
 ***************************************************************************************************/


/***************************************************************************************************
 *                                           GLOBAL VARIABLES
 ***************************************************************************************************/

/***************************************************************************************************
 *                                            LOCAL FUNCTION
 ***************************************************************************************************/

/***************************************************************************************************
 *                                            FUNCTIONS - API
 ***************************************************************************************************/

/***************************************************************************************************
 * @fn      DbgUartInit
 *
 * @brief   Initialize Debug Uart Service for
 *
 * @param   None
 *
 * @return  None
 ***************************************************************************************************/

void DbgUartInit() 
{
//  CLKCONCMD &= ~0x40;  // 设置系统时钟源为 32MHZ 晶振
//  while(CLKCONSTA & 0x40);  // 等待晶振稳定 
//  CLKCONCMD &= ~0x47;  // 设置系统主时钟频率为 32MHZ
  PERCFG = 0x00;
  P0SEL |= 0x0C;
  U0CSR |= 0xC0;   
  P2DIR &= ~0xC0;  
  
  U0GCR |= 10;     
  U0BAUD |= 216;   // baudrate: 115200
  UTX0IF = 0;      
  
  DbgUartSendChar('A');
}

void DbgUartSendChar(char Data) 
{
  char tmp;
  tmp = Data;
  U0DBUF = tmp; 
  while(UTX0IF == 0);
  UTX0IF = 0;  
}

void DbgUartPrint(char *Buf)
{
  char data = *Buf;
  while( data != '\0' )
  {
    DbgUartSendChar(data);
    data = *(++Buf);
  }
}

PUTCHAR_PROTOTYPE
{
  DbgUartSendChar((char)ch);

  return ch;
};

/***************************************************************************************************
***************************************************************************************************/




